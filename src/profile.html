<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Perfil - Lia</title>
    <!-- Supabase credentials (rellena con tus valores reales o usa variables de entorno en dev server) -->
    <meta name="supabase-url" content="">
    <meta name="supabase-key" content="">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/profile.css">
    <!-- Estilos específicos para las partículas -->
    <link rel="stylesheet" href="styles/particles-background.css" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="assets/images/icono.png">
    
    <!-- Auth Guard - Protección de autenticación -->
    <script src="utils/auth-guard.js"></script>
    
    <!-- Global theme setup - Configuración global del tema -->
    <script src="scripts/global-theme-setup.js"></script>
</head>
<body>
    <!-- Partículas de fondo estáticas CSS -->
    <div class="particles-container">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>

    <!-- Contenedor principal con fondo dinámico -->
    <div class="auth-container">
        <div class="auth-bg">
            <div class="bg-glow"></div>
            <canvas id="bgParticles"></canvas>
        </div>

    <!-- Header fijo a ancho completo -->
    <header class="header">
        <div class="header-container">
            <button class="back-btn" id="backToCoursesBtn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M19 12H5M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Volver</span>
            </button>
            
            <div class="header-title">
                <h1>Mi Perfil</h1>
                <p>Gestiona tu información personal</p>
            </div>
            
            <!-- Botón de guardar (movido a la posición del botón de tema) -->
            <button class="save-btn" id="saveProfileBtn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H16L21 8V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <polyline points="17,21 17,13 7,13 7,21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <polyline points="7,3 7,8 15,8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Guardar</span>
            </button>
        </div>
    </header>

    <!-- Contenido principal -->
    <main class="main-content">
        <div class="content-wrapper">
            <!-- Columna izquierda - Información del perfil (sticky) -->
            <div class="profile-card">
                <div class="profile-header">
                    <div class="avatar-section">
                        <div class="avatar" id="currentAvatar">
                            <img src="assets/images/icono.png" alt="Foto de perfil" id="avatarImage">
                            <div class="avatar-overlay">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M23 19C23 19.5304 22.7893 20.0391 22.4142 20.4142C22.0391 20.7893 21.5304 21 21 21H3C2.46957 21 1.96086 20.7893 1.58579 20.4142C1.21071 20.0391 1 19.5304 1 19V8C1 7.46957 1.21071 6.96086 1.58579 6.58579C1.96086 6.21071 2.46957 6 3 6H7L9 3H15L17 6H21C21.5304 6 22.0391 6.21071 22.4142 6.58579C22.7893 6.96086 23 7.46957 23 8V19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <circle cx="12" cy="13" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                        </div>
                        <button class="change-photo-btn" id="changeAvatarBtn" type="button">Cambiar foto</button>
                        <input type="file" id="profilePicture" accept="image/*" style="display:none">
                        
                    </div>
                    
                    <div class="user-info">
                        <h2 id="currentFullName">Tu nombre</h2>
                        <p id="currentEmail">tu.email@ejemplo.com</p>
                        <div class="user-badges">
                            <span class="badge primary" id="currentCargoRol">Desarrollador de Software</span>
                        </div>
                        
                        <!-- Panel de administración (solo visible para administradores) -->
                        <div class="admin-panel" id="adminPanel" style="display: none;">
                            <a href="admin/admin.html" class="admin-link">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 1L3 5V11C3 16.55 6.84 21.74 12 23C17.16 21.74 21 16.55 21 11V5L12 1Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                Panel de Administración
                            </a>
                        </div>
                    </div>
                </div>
                
                <!-- Estadísticas del usuario -->
                <div class="stats-section">
                    <div class="stat-item">
                        <div class="stat-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <span class="stat-value" id="coursesCount">2</span>
                            <span class="stat-label">Talleres</span>
                        </div>
                    </div>
                    
                    <div class="stat-item">
                        <div class="stat-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M22 12H18L15 21L9 3L6 12H2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <span class="stat-value" id="progressValue">35%</span>
                            <span class="stat-label">Progreso</span>
                        </div>
                    </div>
                    
                    <div class="stat-item">
                        <div class="stat-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 2L13.09 8.26L20 9L13.09 9.74L12 16L10.91 9.74L4 9L10.91 8.26L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <span class="stat-value" id="streakValue">5</span>
                            <span class="stat-label">Racha</span>
                        </div>
                    </div>
                    
                    <div class="stat-item">
                        <div class="stat-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <span class="stat-value" id="completedCount">8</span>
                            <span class="stat-label">Completados</span>
                        </div>
                    </div>
                    
                    <div class="stat-item">
                        <div class="stat-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <polyline points="12,6 12,12 16,14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <span class="stat-value" id="timeSpent">24h</span>
                            <span class="stat-label">Tiempo</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Panel derecho - Formulario de edición -->
            <div class="form-container">
                <form id="profileForm" class="profile-form">

                    <!-- Información Personal -->
                    <div class="form-section">
                        <div class="section-title">
                            <h3>Información Personal</h3>
                            <p>Detalles personales y profesionales</p>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="firstName">Nombre *</label>
                                <input type="text" id="firstName" name="first_name" value="" placeholder="Nombre" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="lastName">Apellido *</label>
                                <input type="text" id="lastName" name="last_name" value="" placeholder="Apellido" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="username">Nombre de Usuario *</label>
                                <input type="text" id="username" name="username" value="" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="companyRole">Rol en la Empresa</label>
                                <input type="text" id="companyRole" name="company_role" value="" placeholder="Ej: Gerente de Ventas, Desarrollador, Analista...">
                            </div>
                            
                            <div class="form-group">
                                <label for="phone">Teléfono</label>
                                <input type="tel" id="phone" name="phone" value="">
                            </div>
                            
                            <div class="form-group">
                                <label for="location">Ubicación</label>
                                <input type="text" id="location" name="location" value="">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="bio">Biografía</label>
                            <textarea id="bio" name="bio" rows="3" placeholder="Cuéntanos sobre ti, tus intereses y objetivos de aprendizaje..."></textarea>
                        </div>
                    </div>

                    <!-- Seguridad -->
                    <div class="form-section">
                        <div class="section-title">
                            <h3>Seguridad</h3>
                            <p>Gestiona tu email y contraseña</p>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="email">Correo Electrónico *</label>
                                <input type="email" id="email" name="email" value="" placeholder="tu.email@ejemplo.com" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="currentPassword">Contraseña Actual</label>
                                <input type="password" id="currentPassword" name="current_password" placeholder="Ingresa tu contraseña actual">
                            </div>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="newPassword">Nueva Contraseña</label>
                                <input type="password" id="newPassword" name="new_password" placeholder="Mínimo 8 caracteres">
                            </div>
                            
                            <div class="form-group">
                                <label for="confirmPassword">Confirmar Nueva Contraseña</label>
                                <input type="password" id="confirmPassword" name="confirm_password" placeholder="Confirma tu nueva contraseña">
                            </div>
                        </div>
                    </div>

                    <!-- Documentos y Links -->
                    <div class="form-section">
                        <div class="section-title">
                            <h3>Documentos y Links</h3>
                            <p>Gestiona tu curriculum y perfiles profesionales</p>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="curriculum">Curriculum Vitae</label>
                                <div class="file-upload">
                                    <input type="file" id="curriculum" name="curriculum" accept=".pdf,.doc,.docx" style="display: none;">
                                    <button type="button" class="upload-btn" id="curriculumBtn">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <line x1="16" y1="13" x2="8" y2="13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <line x1="16" y1="17" x2="8" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <polyline points="10,9 9,9 8,9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                        <span>Seleccionar CV</span>
                                    </button>
                                    <span class="file-name" id="curriculumName">Ningún archivo seleccionado</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="linkedinUrl">LinkedIn</label>
                                <input type="url" id="linkedinUrl" name="linkedin_url" placeholder="https://linkedin.com/in/tu-perfil" value="">
                            </div>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="portfolioUrl">Portafolio/Sitio Web</label>
                                <input type="url" id="portfolioUrl" name="portfolio_url" placeholder="https://tu-portafolio.com" value="">
                            </div>
                            
                            <div class="form-group">
                                <label for="githubUrl">GitHub</label>
                                <input type="url" id="githubUrl" name="github_url" placeholder="https://github.com/tu-usuario" value="">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <!-- Modal de confirmación -->
    <div class="modal" id="confirmModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Confirmar Cambios</h3>
                <button class="modal-close" id="closeConfirmModal">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <p>¿Estás seguro de que quieres guardar los cambios en tu perfil?</p>
            </div>
            <div class="modal-actions">
                <button class="btn-cancel" id="cancelConfirmBtn">Cancelar</button>
                <button class="btn-confirm" id="confirmSaveBtn">Guardar Cambios</button>
            </div>
        </div>
    </div>
    </div> <!-- Cierre del auth-container -->

    <script src="scripts/theme-manager.js"></script>
    <script src="scripts/profile-manager.js"></script>
    <script src="scripts/file-upload-manager.js"></script>
    <script src="scripts/profile-avatar-manager.js"></script>
    <script src="scripts/profile-particles-direct.js"></script>
    <script src="scripts/avatar-fix-simple.js"></script>
</body>
</html>