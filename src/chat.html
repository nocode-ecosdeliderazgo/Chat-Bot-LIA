<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lia ‚Äî Chat</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&family=Montserrat:wght@700;800&display=swap" rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="icon" type="image/png" href="assets/images/icono.png">
    <meta name="description" content="Lia: asistente inteligente para una experiencia educativa interactiva y personalizada">
    <meta name="keywords" content="coach lia ia, asistente, educativo, inteligencia artificial, taller">
    <meta name="author" content="Tu Nombre">
    
    <!-- Auth Guard - Protecci√≥n de autenticaci√≥n -->
    <script src="utils/auth-guard.js"></script>
    
    <!-- Supabase Client - Base de datos -->
    <script src="scripts/supabase-client.js"></script>
    
    <!-- Global theme setup - Configuraci√≥n global del tema -->
    <script src="scripts/global-theme-setup.js"></script>
    <!-- Enlazar archivo CSS separado -->
    <link rel="stylesheet" href="styles/chat.css">
</head>
<body class="layout-notebook bg-glow-global">
    <div class="layout-3panels">
        <aside class="sidebar-left" id="sidebarLeft">
            <div class="sidebar-header">
                <h3>Herramientas</h3>
                <button class="collapse-btn" id="collapseLeft" title="Ocultar/mostrar">‚ü®‚ü©</button>
            </div>
            <nav class="tool-list">

                <div class="tool-group collapsible" id="livestreamSection">
                    <div class="collapsible-header">
                        <h4 style="margin:0">Chat en vivo</h4>
                        <button id="livestreamToggle" class="collapsible-toggle" aria-expanded="false" aria-controls="livestreamContent" title="Mostrar/Ocultar">
                            <i class='bx bx-chevron-down'></i>
                        </button>
                    </div>
                    <div class="collapsible-content" id="livestreamContent">
                        <!-- Chat del Livestream -->
                        <div class="livestream-chat-container">
                            <div class="livestream-chat-header">
                                <h5>Chat en vivo</h5>
                                <span class="users-count" id="livestreamUsersCount">0 usuarios</span>
                            </div>
                            
                            <div class="livestream-chat-messages" id="livestreamChatMessages">
                                <div class="welcome-message">
                                    <i class='bx bx-message-dots'></i>
                                    <span>¬°√önete a la conversaci√≥n!</span>
                                </div>
                            </div>
                            
                            <div class="livestream-chat-input">
                                <input 
                                    type="text" 
                                    id="livestreamMessageInput" 
                                    placeholder="Conectando al chat‚Ä¶"
                                    maxlength="200"
                                >
                                <button id="livestreamSendBtn" class="livestream-send-btn" disabled title="Enviar mensaje">
                                    <i class='bx bx-send'></i>
                                </button>
                            </div>
                            
                            <!-- Panel de Estado - Toggle entre Chat en Vivo y Chat con LIA -->
                            <div class="connection-panel">
                                <button class="toggle-btn active" data-target="live-chat" id="liveChatToggle">
                                    <i class='bx bx-broadcast'></i>
                                    Chat en Vivo
                                </button>
                                <button class="toggle-btn" data-target="lia-chat" id="liaChatToggle">
                                    <i class='bx bx-brain'></i>
                                    Chat con LIA
                                </button>
                                <!-- Estado de conexi√≥n original (preservado) -->
                                <div class="livestream-connection-status" id="livestreamConnectionStatus">
                                    <span class="status-indicator offline"></span>
                                    <span class="status-text">Desconectado</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


            </nav>
            <div class="left-resizer" id="leftResizer" title="Ajustar ancho"></div>
        </aside>

        <main class="chat-main">
            <!-- Contenedor Principal del Chat (Centro) - Necesario para la l√≥gica -->
            <div class="main-chat-container" id="mainChatContainer" style="display: none;">
                <!-- Chat en Vivo (OCULTO - solo para mantener la l√≥gica) -->
                <div class="live-chat-content active" id="liveChatContent">
                    <div class="telegram-container" id="liveChatPanel">
                <div class="chat-header">
                    <button id="backToCoursesBtn" class="back-to-courses-btn" onclick="window.location.href='cursos.html'" title="Volver a Mis Talleres">
                        <i class='bx bx-chevron-left'></i>
                    </button>
                    <div class="bot-avatar">
                        <img id="botAvatarImg" src="assets/images/FOTO%20LIA.png" alt="Lia" onerror="this.onerror=null;this.src='assets/images/brain-icon.jpg'">
                    </div>
                    <div class="chat-info">
                        <h3>Lia</h3>
                        <p>En l√≠nea</p>
                    </div>
                </div>

                <div class="chat-messages" id="chatMessages">
                    <!-- Los mensajes se generar√°n din√°micamente aqu√≠ -->
                </div>

                <!-- Dynamic Island flotante -->
                <div class="message-input-area">
                    <div class="message-input-wrapper">
                        <div class="input-container" id="inputContainer">
                            <button class="plus-btn" id="sessionMenuButton" type="button" title="M√°s opciones" aria-label="M√°s opciones" onclick="(function(){var gm=document.getElementById('globalMenu'); if(gm){ gm.classList.toggle('show'); }})();">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                            </button>
                            <textarea id="messageInput" placeholder="Escribe tu mensaje..." rows="1" maxlength="500"></textarea>
                            <button id="actionButton" class="action-button" aria-label="Hablar / Enviar" title="Hablar / Enviar">
                                <svg class="mic-icon" width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 14a3 3 0 0 0 3-3V7a3 3 0 0 0-6 0v4a3 3 0 0 0 3 3z" fill="currentColor"/>
                                    <path d="M5 11a7 7 0 0 0 14 0" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    <path d="M12 18v3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                                <svg class="send-icon" width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" fill="currentColor"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Men√∫ global (Sesiones e Informes) -->
                <div class="global-menu" id="globalMenu" aria-hidden="true" style="position:fixed; bottom:84px; z-index:5000;">
                    <div class="gm-group">
                        <button class="gm-item" data-toggle="sessions">Sesiones</button>
                        <div class="gm-submenu" id="gmSessions">
                            <button class="gm-subitem" data-session="1">Sesi√≥n 1</button>
                            <button class="gm-subitem" data-session="2">Sesi√≥n 2</button>
                            <button class="gm-subitem" data-session="3">Sesi√≥n 3</button>
                            <button class="gm-subitem" data-session="4">Sesi√≥n 4</button>
                        </div>
                    </div>
                    <div class="gm-group">
                        <button class="gm-item" data-toggle="reports">Informes</button>
                        <div class="gm-submenu" id="gmReports">
                            <button class="gm-subitem" data-report="docs">Documentos</button>
                            <button class="gm-subitem" data-report="bonos">Bonos</button>
                                </div>
                        </div>
                    </div>
                    </div>
                </div>
            </div>

            <!-- Panel de Live Stream (Centro - Arriba) -->
            <div class="live-stream-main-panel" id="liveStreamMainPanel">
                <div class="live-stream-main-header">
                    <h3>
                        <i class='bx bx-broadcast'></i>
                        Live Stream
                    </h3>
                    <div class="live-stream-main-controls">
                        <button class="live-stream-main-control-btn" id="liveStreamMainConnectBtn" title="Iniciar Stream">
                            <i class='bx bx-broadcast'></i>
                        </button>
                        <button class="live-stream-main-control-btn" id="liveStreamMainDisconnectBtn" title="Detener Stream">
                            <i class='bx bx-stop-circle'></i>
                        </button>

                        <button class="live-stream-main-collapse-btn" id="liveStreamMainCollapseBtn" title="Colapsar/Expandir">
                            <i class='bx bx-chevron-up'></i>
                        </button>
                    </div>
                </div>
                <div class="live-stream-main-content">
                    <div class="live-stream-main-placeholder" id="liveStreamMainPlaceholder">
                        <i class='bx bx-broadcast'></i>
                        <p>Inicia el Live Stream para comenzar la transmisi√≥n</p>
                        <button class="live-stream-main-connect-btn" id="liveStreamMainConnectBtnLarge">
                            <i class='bx bx-broadcast'></i>
                            Iniciar Live Stream
                        </button>
                    </div>
                    
                    <!-- Contenedor para Live Stream -->
                    <div class="live-stream-main-embed-container" id="liveStreamMainEmbedContainer" style="display: none; background: rgba(20, 30, 45, 0.95);">
                        <iframe id="liveStreamMainIframe" src="" frameborder="0" allowfullscreen></iframe>
                    </div>
                </div>
            </div>

            <!-- Panel de Presentaci√≥n (Centro - Abajo) -->
            <div class="presentation-main-panel" id="presentationMainPanel">
                <div class="presentation-main-header">
                    <h3>
                        <i class='bx bx-presentation'></i>
                        Presentaci√≥n
                    </h3>
                    <div class="presentation-main-controls">
                        <button class="presentation-main-control-btn" id="presentationMainPrevBtn" title="Anterior">
                            <i class='bx bx-chevron-left'></i>
                        </button>
                        <span class="presentation-main-counter" id="presentationMainCounter">1 / 10</span>
                        <button class="presentation-main-control-btn" id="presentationMainNextBtn" title="Siguiente">
                            <i class='bx bx-chevron-right'></i>
                        </button>

                        <button class="presentation-main-collapse-btn" id="presentationMainCollapseBtn" title="Colapsar/Expandir">
                            <i class='bx bx-chevron-down'></i>
                        </button>
                    </div>
                </div>
                <div class="presentation-main-content">
                    <div class="presentation-main-placeholder" id="presentationMainPlaceholder">
                        <i class='bx bx-file-blank'></i>
                        <p>No hay presentaci√≥n cargada</p>
                        <button class="load-presentation-main-btn" id="loadPresentationMainBtn">
                            <i class='bx bx-upload'></i>
                            Cargar Presentaci√≥n
                        </button>
                    </div>
                    
                    <!-- Aqu√≠ se mostrar√° la presentaci√≥n -->
                    <div class="presentation-main-embed-container" id="presentationMainEmbedContainer" style="display: none; background: rgba(20, 30, 45, 0.95);">
                        <!-- Contenido directo sin iframe para compatibilidad con Brave -->
                        <div id="presentationContent" class="presentation-content" style="background: rgba(20, 30, 45, 0.95);">
                            <!-- El contenido se insertar√° din√°micamente aqu√≠ -->
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <aside class="studio-right" id="studioRight">
            <div class="studio-header">
                <h3>Studio</h3>
                <button class="collapse-btn" id="collapseRight" title="Ocultar/mostrar">‚ü®‚ü©</button>
            </div>
            
            <div class="studio-cards" id="studioCards"></div>
            <div class="right-resizer" id="rightResizer" title="Ajustar ancho"></div>
        </aside>
    </div>

    <div id="avatarLightbox" class="avatar-lightbox" aria-hidden="true">
        <div class="avatar-lightbox-backdrop"></div>
        <img id="avatarLightboxImg" src="assets/images/FOTO%20LIA.png" alt="Lia">
        <button id="avatarLightboxClose" class="avatar-close" aria-label="Cerrar">√ó</button>
    </div>

    <!-- Socket.IO client: autodetecta origen del servidor en producci√≥n y permite override por localStorage -->
    <script>
        (function() {
            try {
                var current = localStorage.getItem('SOCKET_IO_ORIGIN');
                var heroku = 'https://lia-ia-live-1da7d26ba883.herokuapp.com';
                var host = (window.location && window.location.hostname) ? window.location.hostname : '';

                // Si no hay configuraci√≥n previa, elegir origen seg√∫n dominio p√∫blico
                if (!current) {
                    if (host.includes('ecosdeliderazgo.com')) {
                        // Producci√≥n: API en Netlify, WebSocket en Heroku
                        var netlify = 'https://bot-lia-ai.netlify.app';
                        var heroku = 'https://lia-ia-live-1da7d26ba883.herokuapp.com';
                        window.API_BASE = netlify;
                        window.SOCKET_IO_ORIGIN = heroku;
                        try { localStorage.setItem('API_BASE', netlify); } catch(_) {}
                        try { localStorage.setItem('SOCKET_IO_ORIGIN', heroku); } catch(_) {}
                    } else if (host.endsWith('.netlify.app')) {
                        // Cuando se sirve desde el mismo sitio de Netlify
                        window.SOCKET_IO_ORIGIN = '';
                        window.API_BASE = '';
                    } else {
                        window.SOCKET_IO_ORIGIN = heroku;
                        window.API_BASE = heroku;
                    }
                } else {
                    if (host.includes('ecosdeliderazgo.com')) {
                        var n = 'https://bot-lia-ai.netlify.app';
                        var h = 'https://lia-ia-live-1da7d26ba883.herokuapp.com';
                        window.API_BASE = n;
                        window.SOCKET_IO_ORIGIN = h;
                        try { localStorage.setItem('API_BASE', n); } catch(_) {}
                        try { localStorage.setItem('SOCKET_IO_ORIGIN', h); } catch(_) {}
                    } else {
                        window.SOCKET_IO_ORIGIN = current;
                        window.API_BASE = current;
                    }
                }
            } catch (_) { window.SOCKET_IO_ORIGIN = window.SOCKET_IO_ORIGIN || ''; }
        })();
    </script>
    <!-- Nota: Se omite 'integrity' porque el CDN puede rotar hashes; esto evitaba que el navegador bloquee la carga -->
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script src="scripts/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const input = document.getElementById('messageInput');
            const container = document.getElementById('inputContainer');
            const sessionMenuButton = document.getElementById('sessionMenuButton');
            const globalMenu = document.getElementById('globalMenu');

            function updateState(){
                if (!input || !container) return;
                if (input.value.trim().length > 0) container.classList.add('input-has-text');
                else container.classList.remove('input-has-text');
            }
            if (input){
                ['input','keyup','change'].forEach(ev=> input.addEventListener(ev, updateState));
                updateState();
            }

            // Abrir/cerrar men√∫ global (sesiones/reportes)
            if (sessionMenuButton && globalMenu){
                sessionMenuButton.addEventListener('click', function(e){
                    e.preventDefault(); e.stopPropagation();
                    // Anclar el men√∫ a la izquierda de la isla
                    const island = document.getElementById('inputContainer');
                    if (island){
                        const rect = island.getBoundingClientRect();
                        // 12px de margen desde el borde izquierdo de la isla
                        globalMenu.style.left = (rect.left + 12) + 'px';
                    }
                    globalMenu.classList.toggle('show');
                });
                document.addEventListener('click', function(e){
                    if (!e.target.closest('#globalMenu') && !e.target.closest('#sessionMenuButton')){
                        globalMenu.classList.remove('show');
                    }
                });
            }

            // ===== NUEVA FUNCIONALIDAD - SISTEMA DE TOGGLE =====
            
            // Elementos principales
            const liveChatToggle = document.getElementById('liveChatToggle');
            const liaChatToggle = document.getElementById('liaChatToggle');

            // Sistema de toggle - solo visual para el chat en vivo
            function initializeToggleSystem() {
                console.log('üîß Inicializando sistema de toggle para el chat...');
                
                // Toggle Chat en Vivo
                if (liveChatToggle) {
                    liveChatToggle.addEventListener('click', function() {
                        console.log('üì∫ Chat en Vivo seleccionado');
                        
                        // Actualizar botones
                        liveChatToggle.classList.add('active');
                        liaChatToggle.classList.remove('active');
                        
                        // Aqu√≠ se puede agregar l√≥gica espec√≠fica para el chat en vivo
                        console.log('‚úÖ Chat en Vivo activado');
                    });
                }

                // Toggle Chat con LIA (integrado en el chat en vivo)
                if (liaChatToggle) {
                    liaChatToggle.addEventListener('click', function() {
                        console.log('ü§ñ Chat con LIA seleccionado');
                        
                        // Actualizar botones
                        liaChatToggle.classList.add('active');
                        liveChatToggle.classList.remove('active');
                        
                        // Aqu√≠ se integrar√° LIA dentro del chat en vivo existente
                        console.log('‚úÖ Chat con LIA activado (integrado en chat en vivo)');
                    });
                }
            }

            // Funcionalidad de colapsar/expandir paneles laterales
            function initializePanelCollapse() {
                console.log('üîß Inicializando colapso de paneles...');
                
                const collapseLeft = document.getElementById('collapseLeft');
                const collapseRight = document.getElementById('collapseRight');
                const sidebarLeft = document.getElementById('sidebarLeft');
                const studioRight = document.getElementById('studioRight');
                
                // Colapsar/expandir panel izquierdo
                if (collapseLeft && sidebarLeft) {
                    collapseLeft.addEventListener('click', function() {
                        sidebarLeft.classList.toggle('collapsed');
                        console.log('üì± Panel izquierdo:', sidebarLeft.classList.contains('collapsed') ? 'colapsado' : 'expandido');
                    });
                }
                
                // Colapsar/expandir panel derecho
                if (collapseRight && studioRight) {
                    collapseRight.addEventListener('click', function() {
                        studioRight.classList.toggle('collapsed');
                        console.log('üì± Panel derecho:', studioRight.classList.contains('collapsed') ? 'colapsado' : 'expandido');
                    });
                }
            }

            // Funcionalidad de resizer para paneles
            function initializeResizers() {
                console.log('üîß Inicializando resizers...');
                
                const leftResizer = document.getElementById('leftResizer');
                const rightResizer = document.getElementById('rightResizer');
                const sidebarLeft = document.getElementById('sidebarLeft');
                const studioRight = document.getElementById('studioRight');
                
                // Resizer izquierdo
                if (leftResizer && sidebarLeft) {
                    leftResizer.addEventListener('mousedown', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        const startX = e.clientX;
                        const startWidth = sidebarLeft.offsetWidth;
                        const minWidth = 250;
                        const maxWidth = 500;
                        
                        function onMouseMove(e) {
                            e.preventDefault();
                            const deltaX = e.clientX - startX;
                            const newWidth = Math.max(minWidth, Math.min(maxWidth, startWidth + deltaX));
                            
                            sidebarLeft.style.width = newWidth + 'px';
                            console.log('üìè Panel izquierdo:', newWidth + 'px');
                        }
                        
                        function onMouseUp() {
                            document.removeEventListener('mousemove', onMouseMove);
                            document.removeEventListener('mouseup', onMouseUp);
                            document.body.classList.remove('resizing');
                        }
                        
                        document.body.classList.add('resizing');
                        document.addEventListener('mousemove', onMouseMove);
                        document.addEventListener('mouseup', onMouseUp);
                    });
                }
                
                // Resizer derecho
                if (rightResizer && studioRight) {
                    rightResizer.addEventListener('mousedown', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        const startX = e.clientX;
                        const startWidth = studioRight.offsetWidth;
                        const minWidth = 200;
                        const maxWidth = 400;
                        
                        function onMouseMove(e) {
                            e.preventDefault();
                            const deltaX = startX - e.clientX;
                            const newWidth = Math.max(minWidth, Math.min(maxWidth, startWidth + deltaX));
                            
                            studioRight.style.width = newWidth + 'px';
                            console.log('üìè Panel derecho:', newWidth + 'px');
                        }
                        
                        function onMouseUp() {
                            document.removeEventListener('mousemove', onMouseMove);
                            document.removeEventListener('mouseup', onMouseUp);
                            document.body.classList.remove('resizing');
                        }
                        
                        document.body.classList.add('resizing');
                        document.addEventListener('mousemove', onMouseMove);
                        document.addEventListener('mouseup', onMouseUp);
                    });
                }
            }

            // Funcionalidad de colapsar/expandir secciones
            function initializeCollapsibleSections() {
                console.log('üîß Inicializando secciones colapsibles...');
                
                // Toggle para Chat en Vivo
                const livestreamToggle = document.getElementById('livestreamToggle');
                const livestreamContent = document.getElementById('livestreamContent');
                
                if (livestreamToggle && livestreamContent) {
                    livestreamToggle.addEventListener('click', function() {
                        const isExpanded = livestreamToggle.getAttribute('aria-expanded') === 'true';
                        livestreamToggle.setAttribute('aria-expanded', !isExpanded);
                        livestreamContent.style.display = isExpanded ? 'none' : 'block';
                        console.log('üì∫ Chat en Vivo:', isExpanded ? 'colapsado' : 'expandido');
                    });
                }
                
                // Toggle para Zoom Session
                const zoomToggle = document.getElementById('zoomToggle');
                const zoomContent = document.getElementById('zoomContent');
                
                if (zoomToggle && zoomContent) {
                    zoomToggle.addEventListener('click', function() {
                        const isExpanded = zoomToggle.getAttribute('aria-expanded') === 'true';
                        zoomToggle.setAttribute('aria-expanded', !isExpanded);
                        zoomContent.style.display = isExpanded ? 'none' : 'block';
                        console.log('üé• Zoom Session:', isExpanded ? 'colapsado' : 'expandido');
                    });
                }
            }

            // Funcionalidad de Zoom Session (dentro del panel de herramientas)
            function initializeZoomSection() {
                console.log('üé• Inicializando secci√≥n de Zoom...');
                
                const zoomConnectBtn = document.getElementById('zoomConnectBtn');
                const zoomStatus = document.getElementById('zoomStatus');
                const zoomPlaceholder = document.getElementById('zoomEmbedPlaceholder');
                const zoomContainer = document.getElementById('zoomWebSDKContainer');
                
                // Conectar con Zoom
                if (zoomConnectBtn) {
                    zoomConnectBtn.addEventListener('click', function() {
                        console.log('üîó Conectando con Zoom...');
                        
                        // Cambiar texto del bot√≥n y estado
                        zoomConnectBtn.innerHTML = '<i class="bx bx-loader-alt bx-spin"></i> Conectando...';
                        zoomConnectBtn.disabled = true;
                        
                        // Actualizar estado
                        if (zoomStatus) {
                            const statusIndicator = zoomStatus.querySelector('.status-indicator');
                            const statusText = zoomStatus.querySelector('.status-text');
                            if (statusIndicator) statusIndicator.className = 'status-indicator connecting';
                            if (statusText) statusText.textContent = 'Conectando...';
                        }
                        
                        // Simular conexi√≥n
                        setTimeout(() => {
                            // Ocultar placeholder y mostrar SDK
                            if (zoomPlaceholder) zoomPlaceholder.style.display = 'none';
                            if (zoomContainer) {
                                zoomContainer.style.display = 'block';
                                zoomContainer.innerHTML = `
                                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; 
                                         background: rgba(0,0,0,0.8); border-radius: 6px; color: #44e5ff; font-size: 0.8rem;">
                                        <div style="text-align: center;">
                                            <i class='bx bx-video' style="font-size: 1.5rem; margin-bottom: 4px; display: block;"></i>
                                            <p style="margin: 0; font-size: 0.75rem;">Zoom Web SDK</p>
                                            <small style="color: #94a3b8; font-size: 0.65rem;">Demo activo</small>
                                        </div>
                                    </div>
                                `;
                            }
                            
                            // Actualizar estado y bot√≥n
                            if (zoomStatus) {
                                const statusIndicator = zoomStatus.querySelector('.status-indicator');
                                const statusText = zoomStatus.querySelector('.status-text');
                                if (statusIndicator) statusIndicator.className = 'status-indicator online';
                                if (statusText) statusText.textContent = 'Conectado';
                            }
                            
                            zoomConnectBtn.innerHTML = '<i class="bx bx-video-off"></i> Desconectar';
                            zoomConnectBtn.disabled = false;
                            
                            console.log('‚úÖ Zoom conectado (demo)');
                        }, 2000);
                    });
                }
            }

            // Funcionalidad del Panel de Live Stream Principal (centro)
            function initializeLiveStreamMainPanel() {
                console.log('üì∫ Inicializando panel de Live Stream principal...');
                
                const liveStreamMainConnectBtn = document.getElementById('liveStreamMainConnectBtn');
                const liveStreamMainConnectBtnLarge = document.getElementById('liveStreamMainConnectBtnLarge');
                const liveStreamMainDisconnectBtn = document.getElementById('liveStreamMainDisconnectBtn');
            
                const liveStreamMainCollapseBtn = document.getElementById('liveStreamMainCollapseBtn');
                const liveStreamMainPlaceholder = document.getElementById('liveStreamMainPlaceholder');
                const liveStreamMainEmbedContainer = document.getElementById('liveStreamMainEmbedContainer');
                const liveStreamMainPanel = document.getElementById('liveStreamMainPanel');
                
                // Iniciar Live Stream (bot√≥n peque√±o)
                if (liveStreamMainConnectBtn) {
                    liveStreamMainConnectBtn.addEventListener('click', function() {
                        console.log('üì∫ Iniciando Live Stream (header)...');
                        startLiveStream();
                    });
                }
                
                // Iniciar Live Stream (bot√≥n grande)
                if (liveStreamMainConnectBtnLarge) {
                    liveStreamMainConnectBtnLarge.addEventListener('click', function() {
                        console.log('üì∫ Iniciando Live Stream (placeholder)...');
                        startLiveStream();
                    });
                }
                
                // Detener Live Stream
                if (liveStreamMainDisconnectBtn) {
                    liveStreamMainDisconnectBtn.addEventListener('click', function() {
                        console.log('‚èπÔ∏è Deteniendo Live Stream...');
                        stopLiveStream();
                    });
                }
                

                
                // Funci√≥n para iniciar Live Stream
                function startLiveStream() {
                    // Cambiar texto del bot√≥n y estado
                    if (liveStreamMainConnectBtn) {
                        liveStreamMainConnectBtn.innerHTML = '<i class="bx bx-loader-alt bx-spin"></i>';
                        liveStreamMainConnectBtn.disabled = true;
                    }
                    if (liveStreamMainConnectBtnLarge) {
                        liveStreamMainConnectBtnLarge.innerHTML = '<i class="bx bx-loader-alt bx-spin"></i> Iniciando...';
                        liveStreamMainConnectBtnLarge.disabled = true;
                    }
                    
                    // Simular inicio de stream
                    setTimeout(() => {
                        // Ocultar placeholder y mostrar stream
                        if (liveStreamMainPlaceholder) liveStreamMainPlaceholder.style.display = 'none';
                        if (liveStreamMainEmbedContainer) {
                            liveStreamMainEmbedContainer.style.display = 'block';
                            liveStreamMainEmbedContainer.style.background = 'rgba(20, 30, 45, 0.95)';
                            liveStreamMainEmbedContainer.innerHTML = `
                                <div style="display: flex; align-items: center; justify-content: center; height: 100%; 
                                     background: rgba(20, 30, 45, 0.95); border-radius: 8px; color: #44e5ff; font-size: 0.8rem;">
                                    <div style="text-align: center;">
                                        <i class='bx bx-broadcast' style="font-size: 2rem; margin-bottom: 8px; display: block;"></i>
                                        <p style="margin: 0; font-size: 1rem;">Live Stream Activo</p>
                                        <small style="color: #94a3b8; font-size: 0.8rem;">Transmitiendo en vivo</small>
                                    </div>
                                </div>
                            `;
                        }
                        
                        // Restaurar botones
                        if (liveStreamMainConnectBtn) {
                            liveStreamMainConnectBtn.innerHTML = '<i class="bx bx-stop-circle"></i>';
                            liveStreamMainConnectBtn.disabled = false;
                        }
                        if (liveStreamMainConnectBtnLarge) {
                            liveStreamMainConnectBtnLarge.innerHTML = '<i class="bx bx-broadcast"></i> Iniciar Live Stream';
                            liveStreamMainConnectBtnLarge.disabled = false;
                        }
                        
                        console.log('‚úÖ Live Stream iniciado (demo)');
                    }, 2000);
                }
                
                // Funci√≥n para detener Live Stream
                function stopLiveStream() {
                    // Mostrar placeholder y ocultar stream
                    if (liveStreamMainPlaceholder) liveStreamMainPlaceholder.style.display = 'flex';
                    if (liveStreamMainEmbedContainer) liveStreamMainEmbedContainer.style.display = 'none';
                    
                    console.log('‚úÖ Live Stream detenido');
                }

                // Funcionalidad de colapso del panel
                if (liveStreamMainCollapseBtn && liveStreamMainPanel) {
                    liveStreamMainCollapseBtn.addEventListener('click', function() {
                        console.log('üì∫ Alternando colapso del panel Live Stream...');
                        
                        const isCollapsed = liveStreamMainPanel.classList.contains('collapsed');
                        const liveStreamContent = liveStreamMainPanel.querySelector('.live-stream-main-content');
                        const liveStreamPlaceholder = liveStreamMainPanel.querySelector('.live-stream-main-placeholder');
                        const liveStreamEmbedContainer = liveStreamMainPanel.querySelector('.live-stream-main-embed-container');
                        
                        if (isCollapsed) {
                            // Expandir panel
                            liveStreamMainPanel.classList.remove('collapsed');
                            liveStreamMainCollapseBtn.classList.remove('collapsed');
                            liveStreamMainCollapseBtn.querySelector('i').className = 'bx bx-chevron-up';
                            
                            // Mostrar contenido con transici√≥n suave
                            setTimeout(() => {
                                if (liveStreamContent) {
                                    liveStreamContent.style.display = 'flex';
                                    liveStreamContent.style.opacity = '1';
                                    liveStreamContent.style.visibility = 'visible';
                                }
                                if (liveStreamPlaceholder) {
                                    liveStreamPlaceholder.style.display = 'flex';
                                    liveStreamPlaceholder.style.opacity = '1';
                                    liveStreamPlaceholder.style.visibility = 'visible';
                                }
                                if (liveStreamEmbedContainer) {
                                    liveStreamEmbedContainer.style.display = 'block';
                                    liveStreamEmbedContainer.style.opacity = '1';
                                    liveStreamEmbedContainer.style.visibility = 'visible';
                                }
                            }, 100);
                            
                            console.log('üì∫ Panel Live Stream expandido');
                        } else {
                            // Ocultar contenido primero
                            if (liveStreamContent) {
                                liveStreamContent.style.opacity = '0';
                                liveStreamContent.style.visibility = 'hidden';
                            }
                            if (liveStreamPlaceholder) {
                                liveStreamPlaceholder.style.opacity = '0';
                                liveStreamPlaceholder.style.visibility = 'hidden';
                            }
                            if (liveStreamEmbedContainer) {
                                liveStreamEmbedContainer.style.opacity = '0';
                                liveStreamEmbedContainer.style.visibility = 'hidden';
                            }
                            
                            // Colapsar panel despu√©s de la transici√≥n
                            setTimeout(() => {
                                liveStreamMainPanel.classList.add('collapsed');
                                liveStreamMainCollapseBtn.classList.add('collapsed');
                                liveStreamMainCollapseBtn.querySelector('i').className = 'bx bx-chevron-down';
                                
                                // Ocultar completamente
                                if (liveStreamContent) {
                                    liveStreamContent.style.display = 'none';
                                }
                                if (liveStreamPlaceholder) {
                                    liveStreamPlaceholder.style.display = 'none';
                                }
                                if (liveStreamEmbedContainer) {
                                    liveStreamEmbedContainer.style.display = 'none';
                                }
                            }, 150);
                            
                            console.log('üì∫ Panel Live Stream colapsado');
                        }
                        
                        // Forzar actualizaci√≥n del layout y expandir presentaci√≥n
                        setTimeout(() => {
                            liveStreamMainPanel.style.height = isCollapsed ? '50%' : '60px';
                            
                            // Expandir presentaci√≥n cuando se colapsa Live Stream
                            const presentationPanel = document.getElementById('presentationMainPanel');
                            if (presentationPanel && !isCollapsed) {
                                // Cuando se colapsa Live Stream, expandir presentaci√≥n
                                presentationPanel.style.height = 'calc(100% - 76px)'; // 100% - 60px del panel colapsado - 16px de gap
                                presentationPanel.style.minHeight = 'calc(100% - 76px)';
                                console.log('üìä Presentaci√≥n expandida autom√°ticamente');
                            } else if (presentationPanel && isCollapsed) {
                                // Cuando se expande Live Stream, restaurar presentaci√≥n
                                presentationPanel.style.height = '50%';
                                presentationPanel.style.minHeight = '300px';
                                console.log('üìä Presentaci√≥n restaurada a tama√±o normal');
                            }
                            
                            console.log('üîÑ Layout actualizado');
                        }, 10);
                    });
                } else {
                    console.warn('‚ö†Ô∏è No se encontr√≥ el bot√≥n de colapso del Live Stream');
                }
            }

            function initializePresentationMainPanel() {
                console.log('üìä Inicializando panel de presentaci√≥n principal...');
                
                const loadPresentationMainBtn = document.getElementById('loadPresentationMainBtn');
                const presentationMainPrevBtn = document.getElementById('presentationMainPrevBtn');
                const presentationMainNextBtn = document.getElementById('presentationMainNextBtn');

                const presentationMainCollapseBtn = document.getElementById('presentationMainCollapseBtn');
                const presentationMainCounter = document.getElementById('presentationMainCounter');
                const presentationMainPlaceholder = document.getElementById('presentationMainPlaceholder');
                const presentationMainEmbedContainer = document.getElementById('presentationMainEmbedContainer');
                const presentationMainPanel = document.getElementById('presentationMainPanel');
                
                // Verificar que todos los elementos existen
                if (!loadPresentationMainBtn) {
                    console.error('‚ùå No se encontr√≥ el bot√≥n de cargar presentaci√≥n');
                    return;
                }
                if (!presentationMainPlaceholder) {
                    console.error('‚ùå No se encontr√≥ el placeholder de presentaci√≥n');
                    return;
                }
                if (!presentationMainEmbedContainer) {
                    console.error('‚ùå No se encontr√≥ el contenedor de presentaci√≥n');
                    return;
                }
                
                let currentSlide = 1;
                const totalSlides = 10;
                let currentPresentation = null;
                
                // Cargar presentaci√≥n
                    loadPresentationMainBtn.addEventListener('click', function() {
                    console.log('üì§ Iniciando carga de presentaci√≥n...');
                        
                    try {
                        const input = document.createElement('input');
                        input.type = 'file';
                        input.accept = '.pdf,.ppt,.pptx,.key,.odp';
                        input.multiple = false;
                        
                        input.onchange = function(e) {
                            try {
                            const file = e.target.files[0];
                                if (!file) {
                                    console.log('‚ùå No se seleccion√≥ ning√∫n archivo');
                                    return;
                                }
                                
                                console.log('üìÑ Archivo seleccionado:', file.name, 'Tama√±o:', file.size, 'bytes');
                                
                                // Validar tipo de archivo
                                const allowedTypes = ['.pdf', '.ppt', '.pptx', '.key', '.odp'];
                                const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
                                
                                if (!allowedTypes.includes(fileExtension)) {
                                    alert('‚ùå Tipo de archivo no soportado. Use: PDF, PPT, PPTX, KEY, ODP');
                                    console.error('‚ùå Tipo de archivo no v√°lido:', fileExtension);
                                    return;
                                }
                                
                                // Validar tama√±o (m√°ximo 50MB)
                                if (file.size > 50 * 1024 * 1024) {
                                    alert('‚ùå Archivo demasiado grande. M√°ximo 50MB');
                                    console.error('‚ùå Archivo demasiado grande:', file.size);
                                    return;
                                }
                                
                                // Cambiar estado del bot√≥n
                                loadPresentationMainBtn.innerHTML = '<i class="bx bx-loader-alt bx-spin"></i> Cargando...';
                                loadPresentationMainBtn.disabled = true;
                                
                                // Simular carga (en producci√≥n aqu√≠ ir√≠a la l√≥gica real)
                                setTimeout(() => {
                                    try {
                                                                        // Ocultar placeholder y limpiar cualquier contenido residual
                                        presentationMainPlaceholder.style.display = 'none';
                                        
                                        // Limpiar cualquier iframe residual que pueda estar causando problemas
                                        const embedContainer = document.getElementById('presentationMainEmbedContainer');
                                        if (embedContainer) {
                                            // Eliminar cualquier iframe que pueda estar presente
                                            const existingIframes = embedContainer.querySelectorAll('iframe');
                                            existingIframes.forEach(iframe => {
                                                console.log('üóëÔ∏è Eliminando iframe residual:', iframe);
                                                iframe.remove();
                                            });
                                            
                                            // Limpiar todo el contenido
                                            embedContainer.innerHTML = '';
                                            console.log('üßπ Contenedor limpiado completamente');
                                            
                                            // Asegurar que el contenedor tenga el fondo correcto
                                            embedContainer.style.background = 'rgba(20, 30, 45, 0.95)';
                                        }
                                        
                                        presentationMainEmbedContainer.style.display = 'block';
                                        presentationMainEmbedContainer.style.background = 'rgba(20, 30, 45, 0.95)';
                                        
                                                                                // Limpiar completamente el contenedor y mostrar contenido directo (compatible con Brave)
                                        const presentationContent = document.getElementById('presentationContent');
                                        
                                        if (presentationContent && embedContainer) {
                                            // Limpiar completamente el contenedor
                                            embedContainer.innerHTML = '';
                                            
                                            // Crear nuevo contenedor de contenido
                                            const newContentDiv = document.createElement('div');
                                            newContentDiv.id = 'presentationContent';
                                            newContentDiv.className = 'presentation-content';
                                            newContentDiv.style.background = 'rgba(20, 30, 45, 0.95)';
                                            
                                            // Insertar el contenido
                                            newContentDiv.innerHTML = `
                                                <div class="presentation-container">
                                                    <h1 class="presentation-title">üìä ${file.name}</h1>
                                                    <p class="presentation-status">Presentaci√≥n cargada correctamente</p>
                                                    <p class="presentation-info">Use los controles del header para navegar entre diapositivas</p>
                                                    
                                                    <div class="demo-slide">
                                                        <div class="slide-number">Diapositiva 1 de 10</div>
                                                        <div class="slide-content">
                                                            <h2>Bienvenidos a la Presentaci√≥n</h2>
                                                            <p>Esta es una vista previa de su presentaci√≥n "${file.name}".</p>
                                                            <p>En una implementaci√≥n completa, aqu√≠ se mostrar√≠a el contenido real de la diapositiva.</p>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="file-details">
                                                        <p><strong>Tipo de archivo:</strong> ${fileExtension.toUpperCase()}</p>
                                                        <p><strong>Tama√±o:</strong> ${(file.size / 1024 / 1024).toFixed(2)} MB</p>
                                                        <p><strong>Fecha de carga:</strong> ${new Date().toLocaleString()}</p>
                                                    </div>
                                                </div>
                                            `;
                                            
                                            // Agregar el nuevo contenido al contenedor
                                            embedContainer.appendChild(newContentDiv);
                                            
                                            // Asegurar que todos los elementos tengan el fondo correcto
                                            embedContainer.style.background = 'rgba(20, 30, 45, 0.95)';
                                            newContentDiv.style.background = 'rgba(20, 30, 45, 0.95)';
                                            
                                            // Forzar actualizaci√≥n del DOM
                                            embedContainer.style.display = 'none';
                                            setTimeout(() => {
                                                embedContainer.style.display = 'block';
                                                embedContainer.style.background = 'rgba(20, 30, 45, 0.95)';
                                                console.log('üîÑ DOM actualizado forzadamente');
                                            }, 10);
                                            
                                            console.log('‚úÖ Presentaci√≥n cargada directamente en el DOM (compatible con Brave)');
                                            console.log('üìÑ Archivo procesado:', file.name);
                                            console.log('üìä Contenido generado correctamente');
                                            
                                            // Verificar que el contenido se mostr√≥ correctamente
                                            setTimeout(() => {
                                                const finalContent = document.getElementById('presentationContent');
                                                if (finalContent && finalContent.innerHTML.includes(file.name)) {
                                                    console.log('‚úÖ Verificaci√≥n exitosa: Contenido visible');
                                                } else {
                                                    console.warn('‚ö†Ô∏è Verificaci√≥n fallida: Contenido no visible');
                                                }
                                            }, 100);
                                        } else {
                                            console.error('‚ùå No se encontr√≥ el contenedor de presentaci√≥n');
                                            alert('‚ùå Error: No se pudo cargar la presentaci√≥n');
                                        }
                                        
                                        // Restaurar bot√≥n
                                        loadPresentationMainBtn.innerHTML = '<i class="bx bx-upload"></i> Cargar Presentaci√≥n';
                                        loadPresentationMainBtn.disabled = false;
                                        
                                        currentPresentation = file.name;
                                        console.log('‚úÖ Presentaci√≥n cargada exitosamente:', file.name);
                                        
                                    } catch (error) {
                                        console.error('‚ùå Error al procesar la presentaci√≥n:', error);
                                        alert('‚ùå Error al cargar la presentaci√≥n: ' + error.message);
                                        
                                        // Restaurar bot√≥n en caso de error
                                        loadPresentationMainBtn.innerHTML = '<i class="bx bx-upload"></i> Cargar Presentaci√≥n';
                                        loadPresentationMainBtn.disabled = false;
                                    }
                                }, 1500); // Simular tiempo de carga
                                
                            } catch (error) {
                                console.error('‚ùå Error al procesar archivo:', error);
                                alert('‚ùå Error al procesar el archivo: ' + error.message);
                                
                                // Restaurar bot√≥n en caso de error
                                loadPresentationMainBtn.innerHTML = '<i class="bx bx-upload"></i> Cargar Presentaci√≥n';
                                loadPresentationMainBtn.disabled = false;
                            }
                        };
                        
                        input.onerror = function() {
                            console.error('‚ùå Error al abrir selector de archivos');
                            alert('‚ùå Error al abrir selector de archivos');
                        };
                        
                        input.click();
                        
                    } catch (error) {
                        console.error('‚ùå Error al inicializar carga de presentaci√≥n:', error);
                        alert('‚ùå Error al cargar presentaci√≥n: ' + error.message);
                }
                });
                
                // Navegaci√≥n de diapositivas
                if (presentationMainPrevBtn) {
                    presentationMainPrevBtn.addEventListener('click', function() {
                        if (currentSlide > 1) {
                            currentSlide--;
                            if (presentationMainCounter) {
                            presentationMainCounter.textContent = `${currentSlide} / ${totalSlides}`;
                            }
                            console.log(`‚¨ÖÔ∏è Diapositiva anterior: ${currentSlide}`);
                            
                            // Actualizar contenido del iframe si existe
                            updateSlideContent(currentSlide);
                        } else {
                            console.log('‚ö†Ô∏è Ya est√°s en la primera diapositiva');
                        }
                    });
                } else {
                    console.warn('‚ö†Ô∏è No se encontr√≥ el bot√≥n de diapositiva anterior');
                }
                    
                if (presentationMainNextBtn) {
                    presentationMainNextBtn.addEventListener('click', function() {
                        if (currentSlide < totalSlides) {
                            currentSlide++;
                            if (presentationMainCounter) {
                            presentationMainCounter.textContent = `${currentSlide} / ${totalSlides}`;
                            }
                            console.log(`‚û°Ô∏è Diapositiva siguiente: ${currentSlide}`);
                            
                            // Actualizar contenido del iframe si existe
                            updateSlideContent(currentSlide);
                        } else {
                            console.log('‚ö†Ô∏è Ya est√°s en la √∫ltima diapositiva');
                        }
                    });
                } else {
                    console.warn('‚ö†Ô∏è No se encontr√≥ el bot√≥n de diapositiva siguiente');
                }

                // Funci√≥n para actualizar el contenido de la diapositiva
                function updateSlideContent(slideNumber) {
                    const presentationContent = document.getElementById('presentationContent');
                    if (presentationContent) {
                        try {
                            const slideNumberElement = presentationContent.querySelector('.slide-number');
                            if (slideNumberElement) {
                                slideNumberElement.textContent = `Diapositiva ${slideNumber} de ${totalSlides}`;
                            }
                            
                            const slideContent = presentationContent.querySelector('.slide-content');
                            if (slideContent) {
                                const slideTitles = [
                                    'Bienvenidos a la Presentaci√≥n',
                                    'Agenda del D√≠a',
                                    'Objetivos Principales',
                                    'Metodolog√≠a',
                                    'Recursos Disponibles',
                                    'Cronograma',
                                    'Resultados Esperados',
                                    'Preguntas y Respuestas',
                                    'Pr√≥ximos Pasos',
                                    'Cierre y Conclusiones'
                                ];
                                
                                const slideContents = [
                                    `<h2>${slideTitles[slideNumber - 1]}</h2><p>Esta es la diapositiva ${slideNumber} de su presentaci√≥n.</p><p>Contenido de ejemplo para demostrar la navegaci√≥n.</p>`,
                                    `<h2>${slideTitles[slideNumber - 1]}</h2><ul><li>Introducci√≥n al tema</li><li>Desarrollo de conceptos</li><li>Ejemplos pr√°cticos</li><li>Conclusiones</li></ul>`,
                                    `<h2>${slideTitles[slideNumber - 1]}</h2><p>‚Ä¢ Comprender los conceptos fundamentales</p><p>‚Ä¢ Aplicar conocimientos en casos reales</p><p>‚Ä¢ Desarrollar habilidades pr√°cticas</p>`,
                                    `<h2>${slideTitles[slideNumber - 1]}</h2><p>Metodolog√≠a interactiva que combina:</p><p>‚Ä¢ Teor√≠a y pr√°ctica</p><p>‚Ä¢ Ejemplos del mundo real</p><p>‚Ä¢ Participaci√≥n activa</p>`,
                                    `<h2>${slideTitles[slideNumber - 1]}</h2><p>‚Ä¢ Material de apoyo</p><p>‚Ä¢ Herramientas digitales</p><p>‚Ä¢ Biblioteca de recursos</p><p>‚Ä¢ Soporte t√©cnico</p>`,
                                    `<h2>${slideTitles[slideNumber - 1]}</h2><p>üìÖ Semana 1: Introducci√≥n</p><p>üìÖ Semana 2: Desarrollo</p><p>üìÖ Semana 3: Pr√°ctica</p><p>üìÖ Semana 4: Evaluaci√≥n</p>`,
                                    `<h2>${slideTitles[slideNumber - 1]}</h2><p>‚úÖ Mejora en comprensi√≥n</p><p>‚úÖ Aplicaci√≥n pr√°ctica</p><p>‚úÖ Desarrollo de habilidades</p><p>‚úÖ Evaluaci√≥n positiva</p>`,
                                    `<h2>${slideTitles[slideNumber - 1]}</h2><p>¬øTiene alguna pregunta sobre el contenido?</p><p>Estamos aqu√≠ para ayudarle a comprender mejor los conceptos.</p>`,
                                    `<h2>${slideTitles[slideNumber - 1]}</h2><p>üîÑ Revisar material</p><p>üìù Completar ejercicios</p><p>üìö Investigar m√°s</p><p>üë• Participar en discusiones</p>`,
                                    `<h2>${slideTitles[slideNumber - 1]}</h2><p>Gracias por su atenci√≥n y participaci√≥n.</p><p>Esperamos que esta presentaci√≥n haya sido √∫til.</p><p>¬°Hasta la pr√≥xima!</p>`
                                ];
                                
                                slideContent.innerHTML = slideContents[slideNumber - 1] || `<h2>Diapositiva ${slideNumber}</h2><p>Contenido de la diapositiva ${slideNumber}.</p>`;
                                
                                console.log(`‚úÖ Diapositiva ${slideNumber} actualizada correctamente`);
                            }
                        } catch (error) {
                            console.warn('‚ö†Ô∏è No se pudo actualizar el contenido de la presentaci√≥n:', error);
                        }
                        } else {
                        console.warn('‚ö†Ô∏è No se encontr√≥ el contenedor de presentaci√≥n para actualizar');
                    }
                }
                
                if (!presentationMainCounter) {
                    console.warn('‚ö†Ô∏è No se encontr√≥ el contador de diapositivas');
                }
                
                

                // Funcionalidad de colapso del panel
                if (presentationMainCollapseBtn && presentationMainPanel) {
                    presentationMainCollapseBtn.addEventListener('click', function() {
                        console.log('üìä Alternando colapso del panel Presentaci√≥n...');
                        
                        const isCollapsed = presentationMainPanel.classList.contains('collapsed');
                        const presentationContent = document.getElementById('presentationContent');
                        const embedContainer = document.getElementById('presentationMainEmbedContainer');
                        
                        if (isCollapsed) {
                            // Expandir panel
                            presentationMainPanel.classList.remove('collapsed');
                            presentationMainCollapseBtn.classList.remove('collapsed');
                            presentationMainCollapseBtn.querySelector('i').className = 'bx bx-chevron-down';
                            
                            // Mostrar contenido con transici√≥n suave
                            setTimeout(() => {
                                if (embedContainer) {
                                    embedContainer.style.display = 'block';
                                    embedContainer.style.opacity = '1';
                                    embedContainer.style.visibility = 'visible';
                                }
                                if (presentationContent) {
                                    presentationContent.style.display = 'flex';
                                    presentationContent.style.opacity = '1';
                                    presentationContent.style.visibility = 'visible';
                                }
                            }, 100);
                            
                            console.log('üìä Panel Presentaci√≥n expandido');
                        } else {
                            // Ocultar contenido primero
                            if (embedContainer) {
                                embedContainer.style.opacity = '0';
                                embedContainer.style.visibility = 'hidden';
                            }
                            if (presentationContent) {
                                presentationContent.style.opacity = '0';
                                presentationContent.style.visibility = 'hidden';
                            }
                            
                            // Colapsar panel despu√©s de la transici√≥n
                            setTimeout(() => {
                                presentationMainPanel.classList.add('collapsed');
                                presentationMainCollapseBtn.classList.add('collapsed');
                                presentationMainCollapseBtn.querySelector('i').className = 'bx bx-chevron-up';
                                
                                // Ocultar completamente
                                if (embedContainer) {
                                    embedContainer.style.display = 'none';
                                }
                                if (presentationContent) {
                                    presentationContent.style.display = 'none';
                                }
                            }, 150);
                            
                            console.log('üìä Panel Presentaci√≥n colapsado');
                        }
                        
                        // Forzar actualizaci√≥n del layout
                        setTimeout(() => {
                            presentationMainPanel.style.height = isCollapsed ? '50%' : '60px';
                            
                            // Expandir Live Stream cuando se colapsa la presentaci√≥n
                            const liveStreamPanel = document.getElementById('liveStreamMainPanel');
                            if (liveStreamPanel && !isCollapsed) {
                                // Cuando se colapsa la presentaci√≥n, expandir Live Stream
                                liveStreamPanel.style.height = 'calc(100% - 76px)'; // 100% - 60px del panel colapsado - 16px de gap
                                liveStreamPanel.style.minHeight = 'calc(100% - 76px)';
                                console.log('üì∫ Live Stream expandido autom√°ticamente');
                            } else if (liveStreamPanel && isCollapsed) {
                                // Cuando se expande la presentaci√≥n, restaurar Live Stream
                                liveStreamPanel.style.height = '50%';
                                liveStreamPanel.style.minHeight = '300px';
                                console.log('üì∫ Live Stream restaurado a tama√±o normal');
                            }
                            
                            console.log('üîÑ Layout actualizado');
                        }, 10);
                    });
                } else {
                    console.warn('‚ö†Ô∏è No se encontr√≥ el bot√≥n de colapso de Presentaci√≥n');
                }
            }

            // Funcionalidad del Chat con LIA
            function initializeLiaChat() {
                console.log('ü§ñ Inicializando Chat con LIA...');
                
                const liaMessageInput = document.getElementById('liaMessageInput');
                const liaActionButton = document.getElementById('liaActionButton');
                const liaChatMessages = document.getElementById('liaChatMessages');
                const liaClearChatBtn = document.getElementById('liaClearChatBtn');
                const liaExportChatBtn = document.getElementById('liaExportChatBtn');
                const liaQuickBtns = document.querySelectorAll('.lia-quick-btn');
                
                // Enviar mensaje a LIA
                function sendMessageToLia(message) {
                    if (!message.trim()) return;
                    
                    console.log('üí¨ Enviando mensaje a LIA:', message);
                    
                    // Agregar mensaje del usuario
                    const userMessage = document.createElement('div');
                    userMessage.className = 'lia-message lia-message-user';
                    userMessage.innerHTML = `
                        <div class="lia-message-content">
                            <p>${message}</p>
                        </div>
                        <div class="lia-message-time">Ahora</div>
                    `;
                    liaChatMessages.appendChild(userMessage);
                    
                    // Scroll al final
                    liaChatMessages.scrollTop = liaChatMessages.scrollHeight;
                    
                    // Simular respuesta de LIA
                    setTimeout(() => {
                        const liaResponse = document.createElement('div');
                        liaResponse.className = 'lia-message lia-message-assistant';
                        liaResponse.innerHTML = `
                            <div class="lia-message-avatar">
                                <img src="assets/images/FOTO%20LIA.png" alt="LIA" onerror="this.onerror=null;this.src='assets/images/brain-icon.jpg'">
                            </div>
                            <div class="lia-message-content">
                                <p>Gracias por tu pregunta: "${message}". Esta es una respuesta de demostraci√≥n del sistema de Chat con LIA. En la implementaci√≥n final, aqu√≠ se conectar√≠a con la IA real para proporcionarte respuestas inteligentes y personalizadas.</p>
                            </div>
                            <div class="lia-message-time">Ahora</div>
                        `;
                        liaChatMessages.appendChild(liaResponse);
                        liaChatMessages.scrollTop = liaChatMessages.scrollHeight;
                        console.log('ü§ñ LIA respondi√≥ (demo)');
                    }, 1500);
                }
                
                // Event listeners para el chat
                if (liaActionButton && liaMessageInput) {
                    liaActionButton.addEventListener('click', function() {
                        const message = liaMessageInput.value.trim();
                        if (message) {
                            sendMessageToLia(message);
                            liaMessageInput.value = '';
                        }
                    });
                    
                    liaMessageInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter' && !e.shiftKey) {
                            e.preventDefault();
                            const message = liaMessageInput.value.trim();
                            if (message) {
                                sendMessageToLia(message);
                                liaMessageInput.value = '';
                            }
                        }
                    });
                }
                
                // Botones r√°pidos
                liaQuickBtns.forEach(btn => {
                    btn.addEventListener('click', function() {
                        const prompt = this.getAttribute('data-prompt');
                        if (prompt) {
                            liaMessageInput.value = prompt;
                            sendMessageToLia(prompt);
                            liaMessageInput.value = '';
                        }
                    });
                });
                
                // Limpiar chat
                if (liaClearChatBtn) {
                    liaClearChatBtn.addEventListener('click', function() {
                        console.log('üóëÔ∏è Limpiando chat con LIA');
                        
                        // Mantener solo el mensaje de bienvenida
                        const welcomeMessage = liaChatMessages.querySelector('.lia-message-assistant');
                        liaChatMessages.innerHTML = '';
                        if (welcomeMessage) {
                            liaChatMessages.appendChild(welcomeMessage);
                        }
                    });
                }
                
                // Exportar chat
                if (liaExportChatBtn) {
                    liaExportChatBtn.addEventListener('click', function() {
                        console.log('üì• Exportando chat con LIA');
                        alert('Funcionalidad de exportaci√≥n - Demo');
                    });
                }
            }

            // Inicializar todas las funcionalidades nuevas
            console.log('üöÄ Inicializando nuevas funcionalidades...');
            initializePanelCollapse();
            initializeResizers();
            initializeCollapsibleSections();
            initializeToggleSystem();
            initializeZoomSection();
            initializeLiveStreamMainPanel();
            initializePresentationMainPanel();
            initializeLiaChat();
            console.log('‚úÖ Todas las funcionalidades inicializadas correctamente');
        });
    </script>
</body>
</html>

