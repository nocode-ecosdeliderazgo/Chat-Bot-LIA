<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba Memoria Conversacional Persistente - LIA Bot</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .test-container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .test-header {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        
        .conversation-sequence {
            background: #f8f9fa;
            border-left: 4px solid #e74c3c;
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .message-pair {
            margin: 15px 0;
            padding: 15px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
        }
        
        .message-number {
            background: #e74c3c;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
            font-size: 12px;
        }
        
        .user-message {
            background: #007bff;
            color: white;
            padding: 10px 15px;
            border-radius: 15px;
            margin: 5px 0;
            margin-left: 40px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .user-message:hover {
            background: #0056b3;
        }
        
        .expected-behavior {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 10px;
            border-radius: 6px;
            margin: 5px 0;
            font-size: 14px;
            font-style: italic;
        }
        
        .memory-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        
        .persistence-test {
            background: #d1ecf1;
            border: 1px solid #b6d4d9;
            color: #0c5460;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        
        .long-conversation {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .test-button {
            background: #e74c3c;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            transition: background 0.3s ease;
        }
        
        .test-button:hover {
            background: #c0392b;
        }
        
        .memory-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #dee2e6;
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #e74c3c;
        }
        
        .context-flow {
            background: linear-gradient(45deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #dee2e6;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>üß† Prueba de Memoria Conversacional Persistente</h1>
            <p>Sistema avanzado que mantiene el contexto a trav√©s de m√∫ltiples mensajes y sesiones</p>
        </div>
        
        <div class="memory-info">
            <h2>üîß Problema Solucionado:</h2>
            <p><strong>ANTES:</strong> El contexto se perd√≠a despu√©s de 2 mensajes</p>
            <p><strong>AHORA:</strong> Memoria persistente que analiza los √∫ltimos 10 mensajes y guarda historial completo</p>
        </div>
        
        <div class="persistence-test">
            <h2>üíæ Caracter√≠sticas de la Memoria Persistente:</h2>
            <ul>
                <li>‚úÖ <strong>Historial Completo:</strong> Guarda hasta 50 mensajes en localStorage</li>
                <li>‚úÖ <strong>An√°lisis Contextual:</strong> Analiza los √∫ltimos 10 mensajes para detectar patrones</li>
                <li>‚úÖ <strong>Persistencia entre Sesiones:</strong> Mantiene contexto al recargar la p√°gina</li>
                <li>‚úÖ <strong>Memoria de Temas:</strong> Recuerda temas mencionados anteriormente</li>
                <li>‚úÖ <strong>Detecci√≥n de Continuidad:</strong> Identifica referencias a conversaciones previas</li>
            </ul>
        </div>
        
        <div class="conversation-sequence">
            <h3>üéØ Secuencia de Prueba - Conversaci√≥n Larga (10+ mensajes)</h3>
            
            <div class="message-pair">
                <span class="message-number">1</span>
                <strong>Inicio de conversaci√≥n</strong>
                <div class="user-message" onclick="testMessage('hola como estas')">
                    "hola como estas"
                </div>
                <div class="expected-behavior">Bot debe saludar y mencionar nombre del usuario</div>
            </div>
            
            <div class="message-pair">
                <span class="message-number">2</span>
                <strong>Pregunta t√©cnica</strong>
                <div class="user-message" onclick="testMessage('que es chatgpt')">
                    "que es chatgpt"
                </div>
                <div class="expected-behavior">Bot debe dar definici√≥n espec√≠fica desde BD</div>
            </div>
            
            <div class="message-pair">
                <span class="message-number">3</span>
                <strong>Pregunta relacionada</strong>
                <div class="user-message" onclick="testMessage('y que es un llm')">
                    "y que es un llm"
                </div>
                <div class="expected-behavior">Debe detectar continuidad ("y") y relacionar con ChatGPT</div>
            </div>
            
            <div class="message-pair">
                <span class="message-number">4</span>
                <strong>Cambio de tema</strong>
                <div class="user-message" onclick="testMessage('que temas tiene este curso')">
                    "que temas tiene este curso"
                </div>
                <div class="expected-behavior">Debe ofrecer mostrar cursos disponibles</div>
            </div>
            
            <div class="message-pair">
                <span class="message-number">5</span>
                <strong>Confirmaci√≥n (TEST CR√çTICO)</strong>
                <div class="user-message" onclick="testMessage('si porfavor')">
                    "si porfavor"
                </div>
                <div class="expected-behavior">Debe recordar que ofreci√≥ cursos y mostrar la lista</div>
            </div>
            
            <div class="message-pair">
                <span class="message-number">6</span>
                <strong>Pregunta sobre contenido</strong>
                <div class="user-message" onclick="testMessage('cu√©ntame m√°s sobre el de IA')">
                    "cu√©ntame m√°s sobre el de IA"
                </div>
                <div class="expected-behavior">Debe recordar que se mostraron cursos y dar detalles del curso de IA</div>
            </div>
            
            <div class="message-pair">
                <span class="message-number">7</span>
                <strong>Referencia anterior</strong>
                <div class="user-message" onclick="testMessage('como se relaciona eso con lo que me dijiste de ChatGPT')">
                    "como se relaciona eso con lo que me dijiste de ChatGPT"
                </div>
                <div class="expected-behavior">Debe recordar la definici√≥n de ChatGPT del mensaje #2</div>
            </div>
            
            <div class="message-pair">
                <span class="message-number">8</span>
                <strong>Continuidad pronominal</strong>
                <div class="user-message" onclick="testMessage('eso suena interesante')">
                    "eso suena interesante"
                </div>
                <div class="expected-behavior">Debe entender que "eso" se refiere al curso de IA</div>
            </div>
            
            <div class="message-pair">
                <span class="message-number">9</span>
                <strong>Solicitud de m√°s informaci√≥n</strong>
                <div class="user-message" onclick="testMessage('dime m√°s detalles')">
                    "dime m√°s detalles"
                </div>
                <div class="expected-behavior">Debe proporcionar m√°s informaci√≥n del curso bas√°ndose en el contexto</div>
            </div>
            
            <div class="message-pair">
                <span class="message-number">10</span>
                <strong>Confirmaci√≥n final</strong>
                <div class="user-message" onclick="testMessage('perfecto, me interesa')">
                    "perfecto, me interesa"
                </div>
                <div class="expected-behavior">Debe entender inter√©s en el curso y ofrecer siguiente paso</div>
            </div>
        </div>
        
        <div class="context-flow">
            <h3>üîç An√°lisis de Contexto en Acci√≥n</h3>
            <p>El sistema ahora:</p>
            <ul>
                <li><strong>Detecta Referencias:</strong> "eso", "lo que dijiste", "como mencionaste"</li>
                <li><strong>Mantiene Hilos de Conversaci√≥n:</strong> Conecta ChatGPT ‚Üí LLM ‚Üí Curso IA</li>
                <li><strong>Recuerda Confirmaciones Pendientes:</strong> "si porfavor" se entiende en contexto</li>
                <li><strong>Analiza Patrones:</strong> Detecta cuando el usuario est√° explorando un tema</li>
                <li><strong>Persiste Entre Sesiones:</strong> Mantiene contexto al recargar la p√°gina</li>
            </ul>
        </div>
        
        <div class="memory-stats">
            <div class="stat-card">
                <div class="stat-number" id="historyCount">0</div>
                <div>Mensajes en Historial</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="topicsCount">0</div>
                <div>Temas Mencionados</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="sessionAge">0</div>
                <div>Minutos de Sesi√≥n</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="contextAnalysis">Activo</div>
                <div>An√°lisis de Contexto</div>
            </div>
        </div>
        
        <div class="test-container">
            <h3>üöÄ Pruebas Disponibles:</h3>
            <button class="test-button" onclick="runSequentialTest()">Ejecutar Secuencia Completa</button>
            <button class="test-button" onclick="openChat()">Ir al Chat</button>
            <button class="test-button" onclick="clearMemory()">Limpiar Memoria</button>
            <button class="test-button" onclick="showMemoryContent()">Ver Contenido de Memoria</button>
        </div>
        
        <div id="memoryDisplay" style="display: none;" class="long-conversation">
            <h4>Contenido Actual de la Memoria:</h4>
            <pre id="memoryContent"></pre>
        </div>
    </div>

    <script>
        // Funci√≥n para probar un mensaje espec√≠fico
        function testMessage(message) {
            console.log('üß™ Probando mensaje:', message);
            const chatUrl = `src/chat.html?test_question=${encodeURIComponent(message)}`;
            window.open(chatUrl, '_blank');
        }
        
        // Funci√≥n para ejecutar la secuencia completa autom√°ticamente
        async function runSequentialTest() {
            const messages = [
                'hola como estas',
                'que es chatgpt',
                'y que es un llm', 
                'que temas tiene este curso',
                'si porfavor',
                'cu√©ntame m√°s sobre el de IA',
                'como se relaciona eso con lo que me dijiste de ChatGPT',
                'eso suena interesante',
                'dime m√°s detalles',
                'perfecto, me interesa'
            ];
            
            alert('Se abrir√° una ventana del chat. Copia y pega estos mensajes uno por uno:\n\n' + 
                  messages.map((msg, i) => `${i+1}. ${msg}`).join('\n'));
            
            openChat();
        }
        
        // Funci√≥n para abrir el chat
        function openChat() {
            window.open('src/chat.html', '_blank');
        }
        
        // Funci√≥n para limpiar la memoria
        function clearMemory() {
            if (confirm('¬øEst√°s seguro de que quieres limpiar la memoria conversacional?')) {
                localStorage.removeItem('conversationMemory');
                alert('Memoria limpiada. Recarga la p√°gina del chat para empezar una nueva sesi√≥n.');
                updateStats();
            }
        }
        
        // Funci√≥n para mostrar el contenido de la memoria
        function showMemoryContent() {
            const memoryDisplay = document.getElementById('memoryDisplay');
            const memoryContent = document.getElementById('memoryContent');
            
            const savedMemory = localStorage.getItem('conversationMemory');
            if (savedMemory) {
                memoryContent.textContent = JSON.stringify(JSON.parse(savedMemory), null, 2);
                memoryDisplay.style.display = 'block';
            } else {
                memoryContent.textContent = 'No hay memoria guardada';
                memoryDisplay.style.display = 'block';
            }
        }
        
        // Funci√≥n para actualizar estad√≠sticas
        function updateStats() {
            const savedMemory = localStorage.getItem('conversationMemory');
            if (savedMemory) {
                const memory = JSON.parse(savedMemory);
                document.getElementById('historyCount').textContent = memory.fullHistory?.length || 0;
                document.getElementById('topicsCount').textContent = memory.mentionedTopics?.length || 0;
                
                if (memory.conversationStarted) {
                    const started = new Date(memory.conversationStarted);
                    const now = new Date();
                    const minutes = Math.floor((now - started) / (1000 * 60));
                    document.getElementById('sessionAge').textContent = minutes;
                }
            }
        }
        
        // Actualizar estad√≠sticas cada 5 segundos
        setInterval(updateStats, 5000);
        
        // Actualizar estad√≠sticas al cargar
        document.addEventListener('DOMContentLoaded', function() {
            updateStats();
            
            // Agregar evento de clic a todos los mensajes de prueba
            const messages = document.querySelectorAll('.user-message');
            messages.forEach(message => {
                message.title = 'Clic para probar este mensaje';
            });
        });
    </script>
</body>
</html>